<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root { --bg-color: #F7F9F9; --accent-blue: #1A73E8; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 10px; background-color: var(--bg-color); color: #546E7A; text-align: center; margin: 0; }
    .card { background: white; padding: 30px 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); max-width: 450px; margin: 20px auto; box-sizing: border-box; }
    .pos-btn { display: block; width: 100%; padding: 18px; margin: 12px 0; font-size: 19px; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; color: #546E7A; transition: 0.3s; text-decoration: none; }
    .btn-site { background-color: #D4EBF8; } .btn-in { background-color: #E1F0DA; } .btn-out { background-color: #FFF9C4; }
    .btn-report { background-color: #FFCCBC; color: #BF360C; } .btn-expense { background-color: #FFE0B2; color: #E65100; }
    .status-display { font-size: 24px; font-weight: 900; color: var(--accent-blue); background: #E3F2FD; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
    input, select, textarea { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #ECEFF1; border-radius: 12px; box-sizing: border-box; font-size: 16px; background: #FAFAFA; text-align: center; }
    .main-btn { padding: 18px; font-size: 18px; width: 100%; cursor: pointer; background-color: #A5D6A7; color: white; border: none; border-radius: 15px; font-weight: bold; }
    .section-title { font-weight: bold; color: var(--accent-blue); margin: 20px 0 10px 0; text-align: left; border-left: 5px solid var(--accent-blue); padding-left: 10px; font-size: 18px; }
    #page-record, #group-check, #group-report, #site-section, #expense-section, #expense-upload, #expense-summary, #finish-msg { display: none; }
  </style>
</head>
<body>

  <div id="page-welcome" class="card">
    <h2 style="color:#78909C;">CODE of 2026 SCIn</h2>
    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</p>
    <button type="button" class="pos-btn btn-site" onclick="selectStatus('Site Check In')">üìç Site Check In</button>
    <button type="button" class="pos-btn btn-in" onclick="selectStatus('Check In')">üí™ Check In (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô)</button>
    <button type="button" class="pos-btn btn-out" onclick="selectStatus('Check Out')">üò¥ Check Out (‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô)</button>
    <button type="button" class="pos-btn btn-report" onclick="selectStatus('Report')">üìù Report (‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô)</button>
    <button type="button" class="pos-btn btn-expense" onclick="selectStatus('Expenses')">üí∞ Expenses (‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)</button>
  </div>

  <div id="page-record" class="card">
    <div id="display-status" class="status-display"></div>

    <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
    <input type="text" id="userName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
    <select id="userRegion">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏Ñ (Region) --</option>
      <option>BKK</option><option>CR</option><option>ER</option><option>NER</option><option>NR</option><option>SR</option><option>TE</option><option>DR</option><option>OFFICE</option>
    </select>

    <div id="group-check">
      <div class="section-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
      <input type="text" id="q_buddy" placeholder="‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (Buddy)">
      <select id="q_car" onchange="document.getElementById('q_car_name').style.display=(this.value=='‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'?'block':'none')">
        <option value="‡∏£‡∏ñ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á">‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</option>
        <option value="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠">‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠)</option>
      </select>
      <input type="text" id="q_car_name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ" style="display:none;">
      <input type="number" id="q_mile" placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô">
      <select id="q_loc">
        <option value="">-- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô (Location Type) --</option>
        <option>‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏ï</option><option>‡∏ö‡πâ‡∏≤‡∏ô/‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</option><option>‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°</option>
      </select>
      <textarea id="q_plan" rows="3" placeholder="PLAN / BRIFE ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"></textarea>
    </div>

    <div id="group-report">
      <div class="section-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Report Header)</div>
      <input type="text" id="q_buddy_rep" placeholder="Buddy (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)">
      <input type="date" id="q_date_rep">
      <select id="q_type" onchange="document.getElementById('q_type_etc').style.display=(this.value=='‡∏á‡∏≤‡∏ô ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'?'block':'none')">
        <option value="">-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô (Type) --</option>
        <option>‡∏á‡∏≤‡∏ô CR</option><option>‡∏á‡∏≤‡∏ô OFFICE</option><option>‡∏á‡∏≤‡∏ô TE</option><option>‡∏á‡∏≤‡∏ô DRONE</option><option>‡∏á‡∏≤‡∏ô ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
      </select>
      <input type="text" id="q_type_etc" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" style="display:none;">
      <textarea id="q_job_detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°"></textarea>
    </div>

    <div id="site-section">
      <div id="site-container"></div>
    </div>

    <div id="expense-section">
      <div class="section-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å (Expense Details)</div>
      <input type="date" id="ex_date">
      <input type="text" id="ex_site" placeholder="‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÑ‡∏´‡∏ô?">
      <input type="number" id="ex_oil" placeholder="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)">
      <input type="number" id="ex_hotel" placeholder="‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (‡∏ö‡∏≤‡∏ó)">
      <input type="number" id="ex_ccr" placeholder="‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏° (‡∏ö‡∏≤‡∏ó)">
      <input type="number" id="ex_trav" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)">
    </div>

    <div id="expense-upload">
      <div class="section-title">üì∏ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div>
      <input type="file" id="ex_files" accept="image/*" multiple onchange="selectedFiles=Array.from(this.files); document.getElementById('f-count').innerText='‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß '+selectedFiles.length+' ‡∏£‡∏π‡∏õ'">
      <div id="f-count" style="color:green; font-weight:bold;"></div>
    </div>

    <div id="expense-summary">
      <div id="sum-total" style="font-size:22px; font-weight:bold; color:#2e7d32; margin: 20px 0;"></div>
      <button type="button" class="main-btn" style="background:#2e7d32;" onclick="confirmExpenseFinal()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <button type="button" id="btn-action" class="main-btn" onclick="handleFlow()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî</button>

    <div id="finish-msg">
      <div style="font-size: 60px; color: #4CAF50;"><i class="fas fa-check-circle"></i></div>
      <div id="finish-text-1" style="font-size: 16px; margin: 15px 0;"></div>
      <button type="button" class="main-btn" onclick="location.reload()" style="background:#1A73E8;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </div>

  <input type="file" id="fileInput" accept="image/*" capture="camera" style="display:none" onchange="uploadPhoto(this)">

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwk-spmOFdk-ZLRHhTkJXUshNWmJ6DqvdbNqUByszqLMDVujm7XFe0by-VDVUmNgZmuoQ/exec";
  var selectedStatus = "", reportStep = 1, siteIdx = 1, expenseStep = 1, selectedFiles = [];

  function selectStatus(status) {
    selectedStatus = status;
    document.getElementById('page-welcome').style.display = 'none';
    document.getElementById('page-record').style.display = 'block';
    document.getElementById('display-status').innerText = status;
    document.getElementById('group-check').style.display = (['Check In','Check Out','Site Check In'].includes(status)) ? 'block' : 'none';
    document.getElementById('group-report').style.display = (status === 'Report') ? 'block' : 'none';
    document.getElementById('expense-section').style.display = (status === 'Expenses') ? 'block' : 'none';
  }

  function handleFlow() {
    var region = document.getElementById('userRegion').value;
    if (!document.getElementById('userName').value || !region) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ"); return; }
    
    if (selectedStatus === 'Report') processReport();
    else if (selectedStatus === 'Expenses') processExpense();
    else getGPS();
  }

  function renderSite(n) {
    var div = document.createElement('div');
    div.id = 'site_page_' + n;
    div.innerHTML = `
      <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà ${n} (Site Report)</div>
      ${n === 1 ? `<select id="site_region_job"><option value="">-- ‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏Ñ‡πÑ‡∏´‡∏ô --</option><option>BKK</option><option>CR</option><option>ER</option><option>NER</option><option>NR</option><option>SR</option></select>` : ''}
      <input type="text" id="site_name_${n}" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ã‡∏ï‡πå">
      <input type="text" id="site_prov_${n}" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
      <select id="site_job_${n}">
        <option value="">-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏á‡∏≤‡∏ô --</option>
        <option>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏°</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ CR - CRL</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ CR + ‡∏ô‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏°</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏°</option>
        <option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ CR + ‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏°</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà SA</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô (‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)</option><option>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
      </select>
      <textarea id="site_det_${n}" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô"></textarea>
      <input type="text" id="site_ld_${n}" placeholder="‡∏ú‡∏π‡πâ‡∏ô‡∏≥/‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
      ${n < 4 ? `<select id="next_site_${n}"><option value="‡πÑ‡∏°‡πà‡∏°‡∏µ">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ï‡πà‡∏≠</option><option value="‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà ${n+1}</option></select>` : ''}
    `;
    if(n > 1) document.getElementById('site_page_'+(n-1)).style.display = 'none';
    document.getElementById('site-container').appendChild(div);
  }

  function processReport() {
    if (reportStep === 1) {
      if (document.getElementById('q_type').value === '‡∏á‡∏≤‡∏ô CR') {
        reportStep = 2; renderSite(1);
        document.getElementById('group-report').style.display = 'none';
        document.getElementById('site-section').style.display = 'block';
      } else { sendReportFinal(); }
    } else {
      var next = document.getElementById('next_site_'+siteIdx)?.value;
      if (next === '‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ' && siteIdx < 4) { siteIdx++; renderSite(siteIdx); } 
      else { sendReportFinal(); }
    }
  }

  function sendReportFinal() {
    var d = new Array(60).fill("");
    d[0] = document.getElementById('q_date_rep').value;
