<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CODE of 2026 SCIn</title>
  <style>
    /* ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏µ Pastel ‡πÅ‡∏•‡∏∞ Font ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á M1-5 */
    body { font-family: 'Sarabun', sans-serif; background: #f1faee; color: #1d3557; margin: 0; padding: 15px; }
    .container { max-width: 400px; margin: auto; }
    .page { display: none; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
    .active { display: block; } /* ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á */
    
    h2 { color: #457b9d; margin-top: 0; }
    .btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; }
    .btn-next { background: #a8dadc; color: #1d3557; }
    .btn-back { background: #ccc; color: #666; }
    .btn-main { background: #1A73E8; }
    
    input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
    #preview { width: 100%; border-radius: 15px; margin-top: 15px; display: none; }
  </style>
</head>
<body>

<div class="container">
  <div id="page1" class="page active">
    <h2>CODE of 2026 SCIn</h2>
    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
    <input type="text" id="userName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    <button class="btn btn-next" onclick="showPage(2)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî</button>
  </div>

  <div id="page2" class="page">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
    <button class="btn" style="background:#ffb703" onclick="selectTask('SITE')">üìç Site Check In</button>
    <button class="btn" style="background:#2a9d8f" onclick="selectTask('START')">üí™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
    <button class="btn" style="background:#e76f51" onclick="selectTask('END')">üò¥ ‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</button>
    <button class="btn" style="background:#6a4c93" onclick="showPage(3)">üí∞ ‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</button>
    <button class="btn btn-back" onclick="showPage(1)">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page3" class="page">
    <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
    <select id="expType">
      <option value="‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">üöó ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
      <option value="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£">üç¥ ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
      <option value="‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå">üõ†Ô∏è ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
    </select>
    <input type="number" id="expAmount" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
    <button class="btn btn-main" onclick="selectTask('EXPENSE')">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à & ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button class="btn btn-back" onclick="showPage(2)">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page4" class="page">
    <h2 id="taskTitle">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
    <img id="preview">
    <p id="statusTxt">‡∏£‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS...</p>
    <button class="btn btn-main" id="finalBtn" onclick="finalSubmit()" disabled>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</button>
    <button class="btn btn-back" onclick="showPage(2)">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<input type="file" id="cameraInput" accept="image/*" capture="camera" style="display:none;" onchange="handleImage(this)">

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwk-spmOFdk-ZLRHhTkJXUshNWmJ6DqvdbNqUByszqLMDVujm7XFe0by-VDVUmNgZmuoQ/exec";
  let currentTask = "";
  let base64Image = "";

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö/‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô M1-5)
  function showPage(pageNumber) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page' + pageNumber).classList.add('active');
  }

  function selectTask(task) {
    const name = document.getElementById('userName').value;
    if(!name) { alert("‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return showPage(1); }
    currentTask = task;
    document.getElementById('cameraInput').click(); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
  }

  function handleImage(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        base64Image = e.target.result;
        document.getElementById('preview').src = base64Image;
        document.getElementById('preview').style.display = "block";
        document.getElementById('taskTitle').innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + currentTask;
        showPage(4); // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        getGPS();
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  function getGPS() {
    navigator.geolocation.getCurrentPosition(pos => {
      window.currentPos = pos;
      document.getElementById('statusTxt').innerText = "üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß";
      document.getElementById('finalBtn').disabled = false;
      document.getElementById('finalBtn').innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ";
    }, err => {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS");
    });
  }

  function finalSubmit() {
    const name = document.getElementById('userName').value;
    const expType = document.getElementById('expType').value;
    const expAmount = document.getElementById('expAmount').value;
    
    document.getElementById('finalBtn').innerText = "‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
    document.getElementById('finalBtn').disabled = true;

    const payload = {
      action: currentTask,
      values: [
        new Date().toLocaleString('th-TH'),
        name,
        currentTask,
        window.currentPos.coords.latitude,
        window.currentPos.coords.longitude,
        currentTask === "EXPENSE" ? expType : "",
        currentTask === "EXPENSE" ? expAmount : ""
      ],
      image: base64Image
    };

    fetch(WEB_APP_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    }).then(() => {
      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
      location.reload(); // ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î
    }).catch(err => alert("Error: " + err));
  }
</script>
</body>
</html>
